<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Visor 3D Profesional</title>
  
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    /* --- ESTILOS (CSS) --- */
    body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; }
    .wrap { padding: 20px; max-width: 1000px; margin: 0 auto; }
    
    /* Barra superior */
    .topbar { display: flex; gap: 15px; align-items: center; margin-bottom: 15px; background: white; padding: 10px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    
    select { padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; flex-grow: 1; }
    button { padding: 8px 16px; border: none; background: #007bff; color: white; border-radius: 6px; cursor: pointer; transition: background 0.2s; font-weight: 500; }
    button:hover { background: #0056b3; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    
    /* El Visor 3D */
    model-viewer { 
      width: 100%; height: 60vh; 
      background: #ffffff; 
      border-radius: 16px; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: opacity 0.3s ease; /* Transición suave al cambiar modelo */
    }

    /* Barra inferior de controles */
    .bar { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-top: 15px; justify-content: center; }
    .variant-btn { background: #4a4a4a; }
    .variant-btn:hover { background: #333; }
    
    #info { margin-left: 10px; font-size: 14px; color: #666; width: 100%; text-align: center; margin-top: 10px; }
  </style>
</head>

<body>

  <div class="wrap">
    <div class="topbar">
      <label for="selectorFiguras"><strong>Modelo:</strong></label>
      <select id="selectorFiguras">
        <option value="cubo">Cubo</option>
        <option value="piramide">Pirámide</option>
        <option value="esfera">Esfera</option>
      </select>
      <button id="btnAR" type="button">Ver en AR</button>
    </div>

    <model-viewer id="mv"
      src="models/Cubo.glb" 
      ar
      ar-modes="scene-viewer webxr quick-look"
      camera-controls
      tone-mapping="neutral"
      shadow-intensity="1"
      auto-rotate>
    </model-viewer>

    <div class="bar">
      <button id="btnBase" class="variant-btn" type="button">Sólido (Base)</button>
      <button id="btnVertices" class="variant-btn" type="button">Vértices</button>
      <button id="btnCaras" class="variant-btn" type="button">Caras</button>
    </div>
    <div id="info">Listo. Selecciona una figura.</div>
  </div>

  <script>
    // --- LÓGICA PROFESIONAL (JAVASCRIPT) ---

    // 1. REFERENCIAS AL DOM
    const mv = document.querySelector('#mv');
    const sel = document.querySelector('#selectorFiguras');
    const info = document.querySelector('#info');

    // 2. ESTRUCTURA DE DATOS (Base de datos de modelos)
    // Aquí defines todos tus archivos. Si agregas uno nuevo, solo editas esto.
    const BIBLIOTECA_MODELOS = {
        cubo: {
            nombre: "Cubo",
            base: "models/Cubo.glb",
            vertices: "models/cubo_vertices.glb",
            caras: "models/cubo_caras.glb"
        },
        piramide: {
            nombre: "Pirámide",
            base: "models/Piramide.glb",
            vertices: "models/piramide_vertices.glb",
            caras: "models/piramide_caras.glb"
        },
        esfera: {
            nombre: "Esfera",
            base: "models/Esfera.glb",
            vertices: "models/esfera_vertices.glb",
            caras: "models/esfera_caras.glb"
        }
    };

    // Estado inicial
    let figuraActiva = "cubo"; // Debe coincidir con la primera opción del select

    // 3. CONTROLADOR (La función inteligente)
    /**
     * Carga una variante del modelo actual.
     * @param {string} tipo - Puede ser 'base', 'vertices' o 'caras'
     */
    function cargarVariante(tipo) {
        // Obtenemos los datos de la figura actual
        const datosFigura = BIBLIOTECA_MODELOS[figuraActiva];
        
        // Verificamos si existe la ruta para ese tipo
        if (datosFigura && datosFigura[tipo]) {
            const rutaArchivo = datosFigura[tipo];
            
            // Feedback Visual: Bajamos opacidad para indicar carga
            mv.style.opacity = "0.5";
            info.textContent = `Cargando ${tipo} de ${datosFigura.nombre}...`;

            // Cambiamos la fuente
            mv.src = rutaArchivo;

            // Evento cuando termina de cargar
            mv.addEventListener('load', () => {
                mv.style.opacity = "1"; // Restauramos opacidad
                info.innerHTML = `Viendo: <strong>${tipo.toUpperCase()}</strong> de ${datosFigura.nombre}`;
            }, { once: true });

        } else {
            console.error(`No se encontró el archivo para: ${figuraActiva} -> ${tipo}`);
            info.textContent = `Error: No existe el archivo de ${tipo} para esta figura.`;
        }
    }

    // 4. EVENTOS (Interacción del usuario)

    // A. Cambio en el Menú Desplegable (Select)
    sel.addEventListener('change', (evento) => {
        figuraActiva = evento.target.value; // Actualizamos la variable global
        cargarVariante('base'); // Al cambiar de figura, siempre cargamos la base primero
    });

    // B. Botones Inferiores (Variantes)
    document.querySelector('#btnBase').addEventListener('click', () => {
        cargarVariante('base');
    });

    document.querySelector('#btnVertices').addEventListener('click', () => {
        cargarVariante('vertices');
    });

    document.querySelector('#btnCaras').addEventListener('click', () => {
        cargarVariante('caras');
    });

    // C. Botón de Realidad Aumentada
    document.querySelector('#btnAR').addEventListener('click', () => {
        if (mv.canActivateAR) {
            mv.activateAR();
        } else {
            alert("La Realidad Aumentada no está disponible en este dispositivo/navegador.");
        }
    });

  </script>
</body>
</html>