<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    body { margin: 0; font-family: system-ui, sans-serif; }
    .wrap { padding: 12px; max-width: 1000px; margin: 0 auto; }
    .topbar { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:10px; }
    select, button {
      padding: 10px 12px; border: 1px solid #ccc; background: #fff; border-radius: 10px;
    }
    .bar { display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:10px; }
    #info { font-size: 14px; opacity: .8; }
    model-viewer { width: 100%; height: 60vh; background: #f6f6f6; border-radius: 16px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <label for="figuras"><strong>Figura:</strong></label>
      <select id="figuras" aria-label="Seleccionar figura">
        <option value="models/Cubo.glb">Cubo</option>
        <option value="models/Prisma.glb">Prisma</option>
      </select>

      <button id="btnAR" type="button">Ver en AR</button>
    </div>

    <model-viewer src="modelsCubo.glb" ar ar-modes="scene-viewer webxr quick-look" camera-controls tone-mapping="neutral" poster="poster.png" shadow-intensity="1" environment-image="legacy"> </model-viewer>

    <div class="bar">
      <button id="pp" type="button">Play/Pause</button>
      <button id="prev" type="button">◀ Clip</button>
      <button id="next" type="button">Clip ▶</button>
      <span id="info"></span>
    </div>
  </div>

  <script>
    const mv = document.querySelector('#mv');
    const sel = document.querySelector('#figuras');
    const info = document.querySelector('#info');

    let clips = [];
    let i = 0;

    function refreshClips() {
      clips = mv.availableAnimations || [];
      i = 0;

      if (!clips.length) {
        info.textContent = 'Este modelo no trae animaciones.';
        return;
      }

      // Selecciona el primer clip por defecto
      mv.animationName = clips[0];
      mv.paused = true;
      info.textContent = `Animaciones: ${clips.join(' | ')} (actual: ${mv.animationName})`;
    }

    // Cada vez que cargue un modelo, recalcula clips
    mv.addEventListener('load', refreshClips);

    // Cambiar figura (cambia el src del modelo)
    sel.addEventListener('change', () => {
      mv.src = sel.value;
      info.textContent = 'Cargando modelo...';
      mv.paused = true;
    });

    // Botón AR: dispara el botón interno de AR del componente
    document.querySelector('#btnAR').addEventListener('click', () => {
      // model-viewer crea un botón AR interno si tiene `ar`.
      // requestFullscreen no aplica; aquí invocamos la acción AR del componente.
      mv.activateAR();
    });

    // Play/Pause
    document.querySelector('#pp').addEventListener('click', () => {
      mv.paused = !mv.paused;
    });

    function setClip(newIndex) {
      if (!clips.length) return;
      i = (newIndex + clips.length) % clips.length;
      mv.animationName = clips[i];
      mv.currentTime = 0;
      mv.paused = false;
      info.textContent = `Animaciones: ${clips.join(' | ')} (actual: ${mv.animationName})`;
    }

    document.querySelector('#prev').addEventListener('click', () => setClip(i - 1));
    document.querySelector('#next').addEventListener('click', () => setClip(i + 1));
  </script>
</body>
</html>
