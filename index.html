<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    body { margin: 0; font-family: system-ui, sans-serif; }
    .wrap { padding: 12px; max-width: 1000px; margin: 0 auto; }
    .topbar { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:10px; }
    select, button {
      padding: 10px 12px; border: 1px solid #ccc; background: #fff; border-radius: 10px; cursor: pointer;
    }
    .bar { display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:10px; }
    #info { font-size: 14px; opacity: .8; }
    model-viewer { width: 100%; height: 60vh; background: #f6f6f6; border-radius: 16px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <label for="selectorFiguras"><strong>Figura:</strong></label>
      <select id="selectorFiguras" aria-label="Seleccionar figura">
        <option value="models/Cubo.glb">Cubo</option>
        <option value="models/Prisma.glb">Prisma</option>
      </select>

      <button id="btnAR" type="button">Ver en AR</button>
    </div>

    <model-viewer id="mv"
      src="models/Cubo.glb"
      ar
      ar-modes="scene-viewer webxr quick-look"
      camera-controls
      tone-mapping="neutral"
      poster="poster.png"
      shadow-intensity="1"
      environment-image="legacy">
    </model-viewer>

    <div class="bar">
      <button id="pp" type="button">Play/Pause</button>
      <button id="prev" type="button">◀ Clip</button>
      <button id="next" type="button">Clip ▶</button>
      <span id="info"></span>
    </div>
  </div>

  <script>
    // Referencias a elementos del DOM
    const mv = document.querySelector('#mv');
    const sel = document.querySelector('#selectorFiguras'); // Usamos el ID correcto
    const info = document.querySelector('#info');
    const btnAR = document.querySelector('#btnAR');
    const btnPP = document.querySelector('#pp');
    const btnPrev = document.querySelector('#prev');
    const btnNext = document.querySelector('#next');

    let clips = [];
    let i = 0;

    // Función para actualizar lista de animaciones
    function refreshClips() {
      clips = mv.availableAnimations || [];
      i = 0;

      if (!clips.length) {
        info.textContent = 'Este modelo no trae animaciones.';
        // Desactivar botones de animación si no hay clips
        btnPP.disabled = true;
        return;
      }

      btnPP.disabled = false;
      // Selecciona el primer clip por defecto pero pausado
      mv.animationName = clips[0];
      mv.paused = true;
      info.textContent = `Animaciones: ${clips.join(' | ')} (actual: ${mv.animationName})`;
    }

    // EVENTO 1: Carga del modelo
    mv.addEventListener('load', refreshClips);

    // EVENTO 2: Cambio de Figura (Select)
    sel.addEventListener('change', () => {
      // Cambiamos la fuente del modelo
      mv.src = sel.value;
      
      // Feedback visual
      info.textContent = 'Cargando modelo...';
      mv.paused = true;
    });

    // EVENTO 3: Botón AR manual
    btnAR.addEventListener('click', () => {
      if (mv.canActivateAR) {
        mv.activateAR();
      } else {
        alert("Tu dispositivo no soporta AR o no está disponible en este navegador.");
      }
    });

    // EVENTO 4: Controles de Animación
    btnPP.addEventListener('click', () => {
      mv.paused = !mv.paused;
    });

    function setClip(newIndex) {
      if (!clips.length) return;
      i = (newIndex + clips.length) % clips.length;
      mv.animationName = clips[i];
      mv.currentTime = 0;
      mv.paused = false;
      info.textContent = `Animaciones: ${clips.join(' | ')} (actual: ${mv.animationName})`;
    }

    btnPrev.addEventListener('click', () => setClip(i - 1));
    btnNext.addEventListener('click', () => setClip(i + 1));
  </script>
</body>
</html>